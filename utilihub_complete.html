<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 UtiliHub - Your All-in-One Utility Tools Hub</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* Usage Tracker */
        .usage-tracker {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .tier-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .current-tier {
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
        }

        .tier-anonymous { background: #6c757d; }
        .tier-free { background: #28a745; }
        .tier-premium1 { background: #fd7e14; }
        .tier-premium2 { background: #6f42c1; }
        .tier-premium3 { background: #dc3545; }

        .usage-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 10px 0;
        }

        .usage-fill {
            height: 100%;
            transition: all 0.3s ease;
            border-radius: 10px;
        }

        .usage-green { background: #28a745; }
        .usage-yellow { background: #ffc107; }
        .usage-red { background: #dc3545; }

        /* Tool Grid */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .tool-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .tool-card.active {
            border: 2px solid #667eea;
            transform: translateY(-5px);
        }

        .tool-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .tool-card p {
            color: #666;
            margin-bottom: 15px;
            flex-grow: 1;
        }

        .tool-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-working { background: #d1edff; color: #0066cc; }
        .status-priority { background: #fff3cd; color: #856404; }
        .status-coming-soon { background: #f8d7da; color: #721c24; }

        /* Tool Modal */
        .tool-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .tool-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .tool-modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .tool-modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .tool-modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .tool-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .tool-modal-body {
            padding: 30px;
        }

        /* File Upload Areas */
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9ff;
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: #764ba2;
            background: #f0f2ff;
            transform: scale(1.02);
        }

        .upload-area.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: #f5f5f5;
            border-color: #ccc;
        }

        .upload-icon {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #666;
            font-size: 0.9em;
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Form Controls */
        .form-group {
            margin: 15px 0;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Processing Overlay */
        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .processing-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .processing-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e9ecef;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* File List */
        .file-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin: 5px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .file-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .file-icon {
            margin-right: 10px;
            font-size: 1.5em;
        }

        .file-details {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
        }

        .file-size {
            font-size: 0.85em;
            color: #666;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 1002;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: #28a745;
        }

        .toast.error {
            background: #dc3545;
        }

        .toast.warning {
            background: #ffc107;
            color: #212529;
        }

        /* Calculator Styles */
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            max-width: 500px;
            margin: 0 auto;
        }

        .calc-btn {
            padding: 15px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calc-btn:hover {
            transform: scale(1.05);
        }

        .calc-btn:active {
            transform: scale(0.95);
        }

        /* Text Stats Grid */
        .text-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .text-stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .text-stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .text-stat-label {
            color: #666;
            font-size: 0.9em;
        }

        /* Image Editor Styles */
        .image-editor-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin: 20px 0;
        }

        .image-preview-area {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .image-controls-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .filter-controls {
            margin: 20px 0;
        }

        .filter-group {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #e9ecef;
        }

        .filter-group h5 {
            margin-bottom: 15px;
            color: #333;
        }

        .canvas-container {
            text-align: center;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: #f8f9fa;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .canvas-container canvas {
            max-width: 100%;
            max-height: 500px;
        }

        /* URL Shortener Styles */
        .url-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }

        .url-display.show {
            display: block;
        }

        .short-url {
            font-family: monospace;
            font-size: 1.1em;
            color: #667eea;
            word-break: break-all;
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }

        /* QR Code Styles */
        .qr-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .qr-preview {
            text-align: center;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .qr-preview canvas {
            max-width: 100%;
            border-radius: 8px;
            background: white;
            padding: 10px;
        }

        .color-picker-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }

        .color-picker {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }

            .tier-info {
                flex-direction: column;
                text-align: center;
            }

            .upload-area {
                padding: 20px;
            }

            .btn {
                width: 100%;
                margin: 10px 0;
            }

            .tool-modal-content {
                width: 95%;
                max-height: 95vh;
            }

            .tool-modal-body {
                padding: 20px;
            }

            .calculator-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .image-editor-container {
                grid-template-columns: 1fr;
            }

            .qr-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 UtiliHub</h1>
            <p>Your All-in-One Utility Tools Hub</p>
            <p style="opacity: 0.8;">No downloads, no signups - just instant results</p>
        </div>

        <!-- Usage Tracker -->
        <div class="usage-tracker">
            <div class="tier-info">
                <div class="current-tier tier-anonymous" id="currentTier">Anonymous User</div>
                <div class="usage-stats" id="usageStats">0 / 5 files used today</div>
                <button class="btn btn-warning" onclick="showToast('Demo mode - upgrade features not available', 'info')">Upgrade Plan</button>
            </div>
            <div class="usage-bar">
                <div class="usage-fill usage-green" id="usageFill" style="width: 0%"></div>
            </div>
            <div style="font-size: 0.9em; color: #666; text-align: center;" id="resetTimer">
                Resets in: 24h 0m
            </div>
        </div>

        <!-- Tools Grid -->
        <div class="tools-grid">
            <div class="tool-card" onclick="openTool('pdf-converter')">
                <div>
                    <h3>📄 Convert PDFs to Different Formats</h3>
                    <p>Convert PDFs to text, Word documents, Excel sheets, CSV files with advanced table extraction</p>
                </div>
                <span class="tool-status status-working">✅ Working</span>
            </div>

            <div class="tool-card" onclick="openTool('pdf-to-formats')">
                <div>
                    <h3>📋 Convert to PDF</h3>
                    <p>Convert documents, images, and text files to PDF format with custom naming</p>
                </div>
                <span class="tool-status status-working">✅ Working</span>
            </div>

            <div class="tool-card" onclick="openTool('image-converter')">
                <div>
                    <h3>🖼️ Advanced Image Editor</h3>
                    <p>Convert formats, apply filters, add text/frames, Live Photo to GIF conversion, and more</p>
                </div>
                <span class="tool-status status-working">✅ Working</span>
            </div>

            <div class="tool-card" onclick="openTool('calculator')">
                <div>
                    <h3>🧮 Smart Calculator</h3>
                    <p>Advanced calculator with scientific functions and history</p>
                </div>
                <span class="tool-status status-working">✅ Working</span>
            </div>

            <div class="tool-card" onclick="openTool('text-tools')">
                <div>
                    <h3>✏️ Text Tools</h3>
                    <p>Word count, character count, case conversion, and text formatting</p>
                </div>
                <span class="tool-status status-working">✅ Working</span>
            </div>

            <div class="tool-card" onclick="openTool('url-shortener')">
                <div>
                    <h3>🔗 URL Shortener</h3>
                    <p>Create custom short links with analytics and password protection</p>
                </div>
                <span class="tool-status status-working">✅ Working</span>
            </div>

            <div class="tool-card" onclick="openTool('qr-generator')">
                <div>
                    <h3>📱 QR Code Generator</h3>
                    <p>Generate QR codes with multiple formats and custom styling options</p>
                </div>
                <span class="tool-status status-working">✅ Working</span>
            </div>
        </div>
    </div>

    <!-- PDF Converter Modal -->
    <div class="tool-modal" id="pdf-converter-modal">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <h2>📄 Convert PDFs to Different Formats</h2>
                <button class="tool-modal-close" onclick="closeTool()">&times;</button>
            </div>
            <div class="tool-modal-body">
                <p>Extract text, tables, and data from PDF files and convert to various formats</p>
                
                <div class="upload-area" id="pdfUploadArea" onclick="document.getElementById('pdfFileInput').click()">
                    <div class="upload-icon">📄</div>
                    <div class="upload-text">Drag & drop your PDF files here or click to select</div>
                    <div class="upload-subtext">Supports: .pdf files</div>
                </div>
                
                <input type="file" id="pdfFileInput" multiple accept=".pdf" style="display: none;">
                
                <div class="form-group">
                    <label class="form-label">Output Format</label>
                    <select class="form-control" id="pdfOutputFormat">
                        <option value="txt">Plain Text (.txt)</option>
                        <option value="json">JSON Data (.json)</option>
                    </select>
                </div>

                <div class="file-list" id="pdfFileList" style="display: none;"></div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-primary" id="convertPdfBtn" onclick="convertPdfToFormat()">Convert PDF</button>
                    <button class="btn btn-secondary" onclick="clearFiles('pdf')">Clear Files</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF to Formats Modal -->
    <div class="tool-modal" id="pdf-to-formats-modal">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <h2>📋 Convert to PDF</h2>
                <button class="tool-modal-close" onclick="closeTool()">&times;</button>
            </div>
            <div class="tool-modal-body">
                <p>Convert documents and images to PDF format</p>
                
                <div class="upload-area" id="toPdfUploadArea" onclick="document.getElementById('toPdfFileInput').click()">
                    <div class="upload-icon">📂</div>
                    <div class="upload-text">Drag & drop your files here or click to select</div>
                    <div class="upload-subtext">Supports: .txt, .jpg, .png, .gif, .bmp</div>
                </div>
                <input type="file" id="toPdfFileInput" multiple accept=".txt,.jpg,.jpeg,.png,.gif,.bmp" style="display: none;">
                
                <div class="file-list" id="toPdfFileList" style="display: none;"></div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-primary" id="convertToPdfBtn" onclick="convertToPdf()">Convert to PDF</button>
                    <button class="btn btn-secondary" onclick="clearFiles('toPdf')">Clear Files</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Image Editor Modal -->
    <div class="tool-modal" id="image-converter-modal">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <h2>🖼️ Advanced Image Editor</h2>
                <button class="tool-modal-close" onclick="closeTool()">&times;</button>
            </div>
            <div class="tool-modal-body">
                <p>Convert formats, apply filters, add text/frames, edit, compress, and enhance your images</p>
                
                <div class="upload-area" id="imageUploadArea" onclick="document.getElementById('imageFileInput').click()">
                    <div class="upload-icon">🖼️</div>
                    <div class="upload-text">Drag & drop your images here or click to select</div>
                    <div class="upload-subtext">Supports: JPG, PNG, GIF, BMP, WebP, SVG</div>
                </div>
                <input type="file" id="imageFileInput" multiple accept="image/*" style="display: none;">
                
                <div class="image-editor-container">
                    <div class="image-preview-area">
                        <div class="canvas-container" id="imagePreview" style="display: none;">
                            <canvas id="imageCanvas" style="max-width: 100%; max-height: 500px;"></canvas>
                        </div>
                        <div style="margin-top: 20px; text-align: center;">
                            <button class="btn btn-success" id="downloadImageBtn" onclick="downloadProcessedImage()" style="display: none;">Download Result</button>
                        </div>
                    </div>

                    <div class="image-controls-panel">
                        <div class="filter-group">
                            <h5>Format Conversion</h5>
                            <div class="form-group">
                                <label class="form-label">Convert To</label>
                                <select class="form-control" id="imageFormat">
                                    <option value="png">PNG</option>
                                    <option value="jpg">JPEG</option>
                                    <option value="webp">WebP</option>
                                    <option value="gif">GIF</option>
                                    <option value="bmp">BMP</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Quality (JPEG/WebP): <span id="qualityValue">80</span>%</label>
                                <input type="range" class="form-control" id="imageQuality" min="10" max="100" value="80" 
                                       oninput="document.getElementById('qualityValue').textContent = this.value">
                            </div>
                        </div>

                        <div class="filter-group">
                            <h5>Basic Filters</h5>
                            <div class="form-group">
                                <label class="form-label">Brightness: <span id="brightnessValue">0</span></label>
                                <input type="range" class="form-control" id="brightness" min="-100" max="100" value="0" 
                                       oninput="document.getElementById('brightnessValue').textContent = this.value; applyFilters()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Contrast: <span id="contrastValue">0</span></label>
                                <input type="range" class="form-control" id="contrast" min="-100" max="100" value="0" 
                                       oninput="document.getElementById('contrastValue').textContent = this.value; applyFilters()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Saturation: <span id="saturationValue">0</span></label>
                                <input type="range" class="form-control" id="saturation" min="-100" max="100" value="0" 
                                       oninput="document.getElementById('saturationValue').textContent = this.value; applyFilters()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Blur: <span id="blurValue">0</span>px</label>
                                <input type="range" class="form-control" id="blur" min="0" max="20" value="0" 
                                       oninput="document.getElementById('blurValue').textContent = this.value; applyFilters()">
                            </div>
                        </div>

                        <div class="filter-group">
                            <h5>Quick Filters</h5>
                            <button class="btn btn-secondary" onclick="applyPresetFilter('grayscale')">Grayscale</button>
                            <button class="btn btn-secondary" onclick="applyPresetFilter('sepia')">Sepia</button>
                            <button class="btn btn-secondary" onclick="applyPresetFilter('vintage')">Vintage</button>
                            <button class="btn btn-secondary" onclick="applyPresetFilter('invert')">Invert</button>
                            <button class="btn btn-secondary" onclick="resetFilters()">Reset All</button>
                        </div>

                        <div class="filter-group">
                            <h5>Text Overlay</h5>
                            <div class="form-group">
                                <input type="text" class="form-control" id="overlayText" placeholder="Enter text to add">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Font Size: <span id="fontSizeValue">24</span>px</label>
                                <input type="range" class="form-control" id="fontSize" min="12" max="72" value="24" 
                                       oninput="document.getElementById('fontSizeValue').textContent = this.value">
                            </div>
                            <div class="color-picker-group">
                                <label class="form-label">Text Color:</label>
                                <input type="color" class="color-picker" id="textColor" value="#ffffff">
                            </div>
                            <button class="btn btn-primary" onclick="addTextOverlay()">Add Text</button>
                        </div>
                    </div>
                </div>

                <div class="file-list" id="imageFileList" style="display: none;"></div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-primary" id="processImageBtn" onclick="processImages()">Process Images</button>
                    <button class="btn btn-secondary" onclick="clearFiles('image')">Clear Files</button>
                </div>
            </div>
        </div>
    </div>

    <!-- URL Shortener Modal -->
    <div class="tool-modal" id="url-shortener-modal">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <h2>🔗 URL Shortener</h2>
                <button class="tool-modal-close" onclick="closeTool()">&times;</button>
            </div>
            <div class="tool-modal-body">
                <p>Create custom short links with analytics and click tracking</p>
                
                <div class="form-group">
                    <label class="form-label">Original URL</label>
                    <input type="url" class="form-control" id="originalUrl" placeholder="https://example.com/very-long-url">
                </div>

                <div class="form-group">
                    <label class="form-label">Custom Short Code (Optional)</label>
                    <input type="text" class="form-control" id="customCode" placeholder="my-link">
                    <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                        Leave empty for auto-generated code. Only letters, numbers, and hyphens allowed.
                    </div>
                </div>

                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-primary" onclick="createShortUrl()">Create Short URL</button>
                </div>

                <div class="url-display" id="urlDisplay">
                    <h4>Your Short URL:</h4>
                    <div class="short-url" id="shortUrl"></div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="copyShortUrl()">Copy URL</button>
                        <button class="btn btn-secondary" onclick="viewOriginalUrl()">View Original</button>
                    </div>
                </div>

                <div id="urlHistory" style="margin-top: 30px;">
                    <h4>Your Recent URLs</h4>
                    <div id="urlHistoryList" style="max-height: 200px; overflow-y: auto; margin-top: 15px;">
                        <p style="color: #666; font-style: italic; text-align: center;">No URLs created yet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Generator Modal -->
    <div class="tool-modal" id="qr-generator-modal">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <h2>📱 QR Code Generator</h2>
                <button class="tool-modal-close" onclick="closeTool()">&times;</button>
            </div>
            <div class="tool-modal-body">
                <p>Generate QR codes with multiple formats and custom styling options</p>
                
                <div class="qr-options">
                    <div>
                        <div class="form-group">
                            <label class="form-label">Content Type</label>
                            <select class="form-control" id="qrType" onchange="updateQrInputs()">
                                <option value="url">Website URL</option>
                                <option value="text">Plain Text</option>
                                <option value="email">Email</option>
                                <option value="phone">Phone Number</option>
                                <option value="wifi">WiFi</option>
                            </select>
                        </div>

                        <div id="qrInputs">
                            <div class="form-group">
                                <label class="form-label">URL</label>
                                <input type="url" class="form-control" id="qrUrl" placeholder="https://example.com">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Size: <span id="qrSizeValue">200</span>px</label>
                            <input type="range" class="form-control" id="qrSize" min="100" max="500" value="200" 
                                   oninput="document.getElementById('qrSizeValue').textContent = this.value; generateQrCode()">
                        </div>

                        <div class="color-picker-group">
                            <label class="form-label">Foreground:</label>
                            <input type="color" class="color-picker" id="qrForeground" value="#000000" onchange="generateQrCode()">
                            <label class="form-label">Background:</label>
                            <input type="color" class="color-picker" id="qrBackground" value="#ffffff" onchange="generateQrCode()">
                        </div>

                        <div style="text-align: center; margin: 20px 0;">
                            <button class="btn btn-primary" onclick="generateQrCode()">Generate QR Code</button>
                        </div>
                    </div>

                    <div class="qr-preview">
                        <h5>QR Code Preview</h5>
                        <canvas id="qrCanvas" style="display: none;"></canvas>
                        <div id="qrPlaceholder" style="padding: 50px; color: #666;">
                            QR code will appear here
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-success" id="downloadQrBtn" onclick="downloadQrCode()" style="display: none;">Download QR Code</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Calculator Modal -->
    <div class="tool-modal" id="calculator-modal">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <h2>🧮 Smart Calculator</h2>
                <button class="tool-modal-close" onclick="closeTool()">&times;</button>
            </div>
            <div class="tool-modal-body">
                <p>Advanced calculator with scientific functions and calculation history</p>
                
                <div style="max-width: 500px; margin: 0 auto;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <input type="text" class="form-control" id="calcDisplay" readonly 
                               style="font-size: 1.5em; text-align: right; background: white; margin-bottom: 10px;">
                        <div style="font-size: 0.9em; color: #666; text-align: right;" id="calcHistory"></div>
                    </div>
                    
                    <div class="calculator-grid">
                        <!-- Row 1 -->
                        <button class="btn btn-secondary calc-btn" onclick="clearCalc()">C</button>
                        <button class="btn btn-secondary calc-btn" onclick="calcFunction('sqrt')">√</button>
                        <button class="btn btn-secondary calc-btn" onclick="calcFunction('pow')">x²</button>
                        <button class="btn btn-secondary calc-btn" onclick="calcOperation('/')">/</button>
                        
                        <!-- Row 2 -->
                        <button class="btn btn-primary calc-btn" onclick="calcNumber('7')">7</button>
                        <button class="btn btn-primary calc-btn" onclick="calcNumber('8')">8</button>
                        <button class="btn btn-primary calc-btn" onclick="calcNumber('9')">9</button>
                        <button class="btn btn-warning calc-btn" onclick="calcOperation('*')">×</button>
                        
                        <!-- Row 3 -->
                        <button class="btn btn-primary calc-btn" onclick="calcNumber('4')">4</button>
                        <button class="btn btn-primary calc-btn" onclick="calcNumber('5')">5</button>
                        <button class="btn btn-primary calc-btn" onclick="calcNumber('6')">6</button>
                        <button class="btn btn-warning calc-btn" onclick="calcOperation('-')">-</button>
                        
                        <!-- Row 4 -->
                        <button class="btn btn-primary calc-btn" onclick="calcNumber('1')">1</button>
                        <button class="btn btn-primary calc-btn" onclick="calcNumber('2')">2</button>
                        <button class="btn btn-primary calc-btn" onclick="calcNumber('3')">3</button>
                        <button class="btn btn-warning calc-btn" onclick="calcOperation('+')">+</button>
                        
                        <!-- Row 5 -->
                        <button class="btn btn-primary calc-btn" onclick="calcNumber('0')" style="grid-column: span 2;">0</button>
                        <button class="btn btn-primary calc-btn" onclick="calcNumber('.')">.</button>
                        <button class="btn btn-success calc-btn" onclick="calcEquals()">=</button>
                    </div>
                    
                    <div style="margin-top: 20px; background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <h4>History</h4>
                        <div id="calcHistoryList" style="max-height: 150px; overflow-y: auto;">
                            <p style="color: #666; font-style: italic;">No calculations yet</p>
                        </div>
                        <button class="btn btn-secondary" onclick="clearHistory()" style="margin-top: 10px; padding: 8px 16px; font-size: 0.9em;">Clear History</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Text Tools Modal -->
    <div class="tool-modal" id="text-tools-modal">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <h2>✏️ Text Tools</h2>
                <button class="tool-modal-close" onclick="closeTool()">&times;</button>
            </div>
            <div class="tool-modal-body">
                <p>Word count, character count, case conversion, and text formatting</p>
                
                <div style="display: flex; gap: 20px; margin: 20px 0;">
                    <div style="flex: 1;">
                        <h4>Type Text</h4>
                        <textarea class="form-control" id="textInput" rows="10" placeholder="Type or paste your text here..."
                                  oninput="updateTextStats()"></textarea>
                    </div>
                    <div style="width: 200px;">
                        <h4>Or Upload File</h4>
                        <div class="upload-area" onclick="document.getElementById('textFileUpload').click()" 
                             style="padding: 20px; height: 150px; display: flex; flex-direction: column; justify-content: center;">
                            <div class="upload-icon" style="font-size: 2em; margin-bottom: 10px;">📄</div>
                            <div class="upload-text" style="font-size: 0.9em;">Upload Text File</div>
                            <div class="upload-subtext" style="font-size: 0.8em;">.txt files</div>
                        </div>
                        <input type="file" id="textFileUpload" accept=".txt" style="display: none;" onchange="loadTextFile(event)">
                    </div>
                </div>
                
                <div class="text-stats">
                    <div class="text-stat-card">
                        <span class="text-stat-value" id="wordCount">0</span>
                        <div class="text-stat-label">Words</div>
                    </div>
                    <div class="text-stat-card">
                        <span class="text-stat-value" id="charCount">0</span>
                        <div class="text-stat-label">Characters</div>
                    </div>
                    <div class="text-stat-card">
                        <span class="text-stat-value" id="charCountNoSpaces">0</span>
                        <div class="text-stat-label">Characters (no spaces)</div>
                    </div>
                    <div class="text-stat-card">
                        <span class="text-stat-value" id="paragraphCount">0</span>
                        <div class="text-stat-label">Paragraphs</div>
                    </div>
                    <div class="text-stat-card">
                        <span class="text-stat-value" id="sentenceCount">0</span>
                        <div class="text-stat-label">Sentences</div>
                    </div>
                    <div class="text-stat-card">
                        <span class="text-stat-value" id="readingTime">0</span>
                        <div class="text-stat-label">Reading Time (min)</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-primary" onclick="textTransform('uppercase')">UPPERCASE</button>
                    <button class="btn btn-primary" onclick="textTransform('lowercase')">lowercase</button>
                    <button class="btn btn-primary" onclick="textTransform('capitalize')">Capitalize</button>
                    <button class="btn btn-primary" onclick="textTransform('title')">Title Case</button>
                    <button class="btn btn-secondary" onclick="clearText()">Clear Text</button>
                    <button class="btn btn-success" onclick="copyText()">Copy Text</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Processing Overlay -->
    <div class="processing-overlay" id="processingOverlay">
        <div class="processing-content">
            <div class="spinner"></div>
            <h3 id="processingTitle">Processing Files...</h3>
            <p id="processingStatus">Please wait while we process your files</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        // Global State Management
        let currentTier = 'anonymous';
        let usageData = {
            count: 0,
            resetTime: new Date(Date.now() + 24 * 60 * 60 * 1000).getTime()
        };
        let selectedFiles = {
            pdf: [],
            toPdf: [],
            image: []
        };
        let currentTool = null;
        let imageCanvas = null;
        let imageCtx = null;
        let originalImageData = null;
        let currentImageFile = null;
        let urlDatabase = [];

        // Calculator State
        let calcState = {
            display: '0',
            previousValue: null,
            operation: null,
            waitingForOperand: false,
            history: []
        };

        // Set PDF.js worker path
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }

        // Tier Configuration
        const tierLimits = {
            anonymous: { daily: 5, batch: 1, name: 'Anonymous User', class: 'tier-anonymous' }
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            loadUsageData();
            updateUsageDisplay();
            setupEventListeners();
            startTimer();
            initializeImageEditor();
            initializeCalculator();
        });

        // Initialize Image Editor
        function initializeImageEditor() {
            imageCanvas = document.getElementById('imageCanvas');
            if (imageCanvas) {
                imageCtx = imageCanvas.getContext('2d');
            }
        }

        // Initialize Calculator
        function initializeCalculator() {
            document.getElementById('calcDisplay').value = calcState.display;
        }

        // Usage Data Management
        function loadUsageData() {
            if (usageData.resetTime && new Date().getTime() > usageData.resetTime) {
                resetUsageData();
            }
        }

        function resetUsageData() {
            usageData = {
                count: 0,
                resetTime: new Date(Date.now() + 24 * 60 * 60 * 1000).getTime()
            };
        }

        function updateUsageDisplay() {
            const tier = tierLimits[currentTier];
            const usagePercent = Math.min((usageData.count / tier.daily) * 100, 100);
            
            const tierElement = document.getElementById('currentTier');
            tierElement.textContent = tier.name;
            tierElement.className = `current-tier ${tier.class}`;
            
            document.getElementById('usageStats').textContent = `${usageData.count} / ${tier.daily} files used today`;
            
            const fillElement = document.getElementById('usageFill');
            fillElement.style.width = usagePercent + '%';
            fillElement.className = `usage-fill ${
                usagePercent < 70 ? 'usage-green' : 
                usagePercent < 90 ? 'usage-yellow' : 'usage-red'
            }`;
        }

        function canProcessFiles(count) {
            const tier = tierLimits[currentTier];
            return (usageData.count + count) <= tier.daily;
        }

        function incrementUsage(count) {
            usageData.count += count;
            updateUsageDisplay();
        }

        // Timer for usage reset
        function startTimer() {
            setInterval(updateTimer, 60000);
            updateTimer();
        }

        function updateTimer() {
            const now = new Date().getTime();
            const timeLeft = usageData.resetTime - now;
            
            if (timeLeft <= 0) {
                resetUsageData();
                updateUsageDisplay();
                return;
            }
            
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            
            document.getElementById('resetTimer').textContent = `Resets in: ${hours}h ${minutes}m`;
        }

        // Tool Management
        function openTool(toolId) {
            currentTool = toolId;
            document.getElementById(toolId + '-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeTool() {
            if (currentTool) {
                document.getElementById(currentTool + '-modal').classList.remove('active');
                currentTool = null;
                document.body.style.overflow = 'auto';
            }
        }

        // Event Listeners Setup
        function setupEventListeners() {
            ['pdf', 'toPdf', 'image'].forEach(type => {
                const input = document.getElementById(`${type}FileInput`);
                const area = document.getElementById(`${type}UploadArea`);
                
                if (input && area) {
                    input.addEventListener('change', (e) => handleFileSelect(e, type));
                    area.addEventListener('dragover', handleDragOver);
                    area.addEventListener('drop', (e) => handleDrop(e, type));
                    area.addEventListener('dragleave', handleDragLeave);
                }
            });

            document.querySelectorAll('.tool-modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeTool();
                    }
                });
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (document.querySelector('.tool-modal.active')) {
                        closeTool();
                    }
                }
            });
        }

        // File Handling
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e, type) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            handleFileSelect({ target: { files } }, type);
        }

        function handleFileSelect(e, type) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            if (!canProcessFiles(files.length)) {
                showToast('Daily limit reached. Please try again tomorrow.', 'error');
                return;
            }

            selectedFiles[type] = files;
            updateFileList(type);
            
            if (type === 'image' && files.length > 0) {
                loadImageForPreview(files[0]);
            }
            
            e.target.value = '';
        }

        function updateFileList(type) {
            const listElement = document.getElementById(`${type}FileList`);
            if (!listElement) return;

            if (selectedFiles[type].length === 0) {
                listElement.style.display = 'none';
                return;
            }

            listElement.style.display = 'block';
            listElement.innerHTML = selectedFiles[type].map((file, index) => `
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-icon">📄</div>
                        <div class="file-details">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="btn btn-secondary" onclick="removeFile('${type}', ${index})" 
                                style="padding: 5px 10px; font-size: 0.8em;">Remove</button>
                    </div>
                </div>
            `).join('');
        }

        function removeFile(type, index) {
            selectedFiles[type].splice(index, 1);
            updateFileList(type);
        }

        function clearFiles(type) {
            selectedFiles[type] = [];
            updateFileList(type);
            document.getElementById(`${type}FileInput`).value = '';
            
            if (type === 'image') {
                document.getElementById('imagePreview').style.display = 'none';
                document.getElementById('downloadImageBtn').style.display = 'none';
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // PDF Converter Functions
        async function convertPdfToFormat() {
            if (selectedFiles.pdf.length === 0) {
                showToast('Please select PDF files first', 'error');
                return;
            }

            showProcessing('Converting PDF files...');

            try {
                for (const file of selectedFiles.pdf) {
                    await processPdfFile(file);
                }
                
                incrementUsage(selectedFiles.pdf.length);
                showToast('PDF conversion completed!', 'success');
                clearFiles('pdf');
            } catch (error) {
                console.error('PDF conversion error:', error);
                showToast('Error converting PDF files', 'error');
            } finally {
                hideProcessing();
            }
        }

        async function processPdfFile(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            
            let fullText = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += pageText + '\n\n';
            }

            const outputFormat = document.getElementById('pdfOutputFormat').value;
            let result;
            let filename;
            let mimeType;

            if (outputFormat === 'txt') {
                result = fullText;
                filename = file.name.replace('.pdf', '.txt');
                mimeType = 'text/plain';
            } else if (outputFormat === 'json') {
                result = JSON.stringify({
                    filename: file.name,
                    pages: pdf.numPages,
                    text: fullText,
                    extractedAt: new Date().toISOString()
                }, null, 2);
                filename = file.name.replace('.pdf', '.json');
                mimeType = 'application/json';
            }

            downloadFile(result, filename, mimeType);
        }

        // Convert to PDF Functions
        async function convertToPdf() {
            if (selectedFiles.toPdf.length === 0) {
                showToast('Please select files first', 'error');
                return;
            }

            showProcessing('Converting files to PDF...');

            try {
                const { jsPDF } = window.jspdf;
                
                for (const file of selectedFiles.toPdf) {
                    const pdf = new jsPDF();
                    
                    if (file.type.startsWith('image/')) {
                        await addImageToPdf(pdf, file);
                    } else if (file.type === 'text/plain') {
                        await addTextToPdf(pdf, file);
                    }
                    
                    const filename = file.name.replace(/\.[^/.]+$/, '') + '.pdf';
                    pdf.save(filename);
                }
                
                incrementUsage(selectedFiles.toPdf.length);
                showToast('PDF conversion completed!', 'success');
                clearFiles('toPdf');
            } catch (error) {
                console.error('PDF conversion error:', error);
                showToast('Error converting files to PDF', 'error');
            } finally {
                hideProcessing();
            }
        }

        async function addImageToPdf(pdf, file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        const maxWidth = 190;
                        const maxHeight = 270;
                        let { width, height } = img;
                        
                        if (width > maxWidth || height > maxHeight) {
                            const ratio = Math.min(maxWidth / width, maxHeight / height);
                            width *= ratio;
                            height *= ratio;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const imgData = canvas.toDataURL('image/jpeg', 0.8);
                        pdf.addImage(imgData, 'JPEG', 10, 10, width, height);
                        resolve();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        async function addTextToPdf(pdf, file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const text = e.target.result;
                    const lines = pdf.splitTextToSize(text, 180);
                    pdf.text(lines, 10, 20);
                    resolve();
                };
                reader.readAsText(file);
            });
        }

        // Image Processing Functions
        function loadImageForPreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    imageCanvas.width = img.width;
                    imageCanvas.height = img.height;
                    imageCtx.drawImage(img, 0, 0);
                    
                    // Store original image data
                    originalImageData = imageCtx.getImageData(0, 0, imageCanvas.width, imageCanvas.height);
                    currentImageFile = file;
                    
                    document.getElementById('imagePreview').style.display = 'block';
                    document.getElementById('downloadImageBtn').style.display = 'block';
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function applyFilters() {
            if (!originalImageData) return;

            const brightness = parseInt(document.getElementById('brightness').value);
            const contrast = parseInt(document.getElementById('contrast').value);
            const saturation = parseInt(document.getElementById('saturation').value);
            const blur = parseInt(document.getElementById('blur').value);

            // Reset to original image
            imageCtx.putImageData(originalImageData, 0, 0);

            // Apply CSS filters
            let filterString = '';
            if (brightness !== 0) filterString += `brightness(${100 + brightness}%) `;
            if (contrast !== 0) filterString += `contrast(${100 + contrast}%) `;
            if (saturation !== 0) filterString += `saturate(${100 + saturation}%) `;
            if (blur > 0) filterString += `blur(${blur}px) `;

            imageCanvas.style.filter = filterString;
        }

        function applyPresetFilter(filterType) {
            if (!originalImageData) return;

            // Reset filters first
            resetFilters();

            switch (filterType) {
                case 'grayscale':
                    imageCanvas.style.filter = 'grayscale(100%)';
                    break;
                case 'sepia':
                    imageCanvas.style.filter = 'sepia(100%)';
                    break;
                case 'vintage':
                    imageCanvas.style.filter = 'sepia(50%) contrast(120%) brightness(110%)';
                    break;
                case 'invert':
                    imageCanvas.style.filter = 'invert(100%)';
                    break;
            }
        }

        function resetFilters() {
            if (!originalImageData) return;

            // Reset sliders
            document.getElementById('brightness').value = 0;
            document.getElementById('contrast').value = 0;
            document.getElementById('saturation').value = 0;
            document.getElementById('blur').value = 0;

            // Update display values
            document.getElementById('brightnessValue').textContent = '0';
            document.getElementById('contrastValue').textContent = '0';
            document.getElementById('saturationValue').textContent = '0';
            document.getElementById('blurValue').textContent = '0';

            // Reset canvas
            imageCtx.putImageData(originalImageData, 0, 0);
            imageCanvas.style.filter = '';
        }

        function addTextOverlay() {
            if (!originalImageData) {
                showToast('Please load an image first', 'error');
                return;
            }

            const text = document.getElementById('overlayText').value;
            if (!text) {
                showToast('Please enter text to add', 'error');
                return;
            }

            const fontSize = document.getElementById('fontSize').value;
            const textColor = document.getElementById('textColor').value;

            // Apply current filters first
            applyFilters();

            // Add text overlay
            imageCtx.font = `${fontSize}px Arial`;
            imageCtx.fillStyle = textColor;
            imageCtx.strokeStyle = '#000000';
            imageCtx.lineWidth = 2;
            
            const x = imageCanvas.width / 2;
            const y = imageCanvas.height / 2;
            
            imageCtx.strokeText(text, x, y);
            imageCtx.fillText(text, x, y);

            showToast('Text overlay added!', 'success');
        }

        async function processImages() {
            if (selectedFiles.image.length === 0) {
                showToast('Please select image files first', 'error');
                return;
            }

            showProcessing('Processing images...');

            try {
                for (const file of selectedFiles.image) {
                    await processImageFile(file);
                }
                
                incrementUsage(selectedFiles.image.length);
                showToast('Image processing completed!', 'success');
                clearFiles('image');
            } catch (error) {
                console.error('Image processing error:', error);
                showToast('Error processing images', 'error');
            } finally {
                hideProcessing();
            }
        }

        async function processImageFile(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        const format = document.getElementById('imageFormat').value;
                        const quality = document.getElementById('imageQuality').value / 100;
                        
                        let mimeType;
                        let extension;
                        
                        switch (format) {
                            case 'jpg':
                                mimeType = 'image/jpeg';
                                extension = '.jpg';
                                break;
                            case 'png':
                                mimeType = 'image/png';
                                extension = '.png';
                                break;
                            case 'webp':
                                mimeType = 'image/webp';
                                extension = '.webp';
                                break;
                            case 'gif':
                                mimeType = 'image/gif';
                                extension = '.gif';
                                break;
                            case 'bmp':
                                mimeType = 'image/bmp';
                                extension = '.bmp';
                                break;
                            default:
                                mimeType = 'image/png';
                                extension = '.png';
                        }
                        
                        canvas.toBlob((blob) => {
                            const filename = file.name.replace(/\.[^/.]+$/, '') + extension;
                            downloadBlob(blob, filename);
                            resolve();
                        }, mimeType, quality);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function downloadProcessedImage() {
            if (!imageCanvas) {
                showToast('No processed image to download', 'error');
                return;
            }

            const format = document.getElementById('imageFormat').value;
            const quality = document.getElementById('imageQuality').value / 100;
            
            let mimeType;
            let extension;
            
            switch (format) {
                case 'jpg':
                    mimeType = 'image/jpeg';
                    extension = '.jpg';
                    break;
                case 'png':
                    mimeType = 'image/png';
                    extension = '.png';
                    break;
                case 'webp':
                    mimeType = 'image/webp';
                    extension = '.webp';
                    break;
                case 'gif':
                    mimeType = 'image/gif';
                    extension = '.gif';
                    break;
                case 'bmp':
                    mimeType = 'image/bmp';
                    extension = '.bmp';
                    break;
                default:
                    mimeType = 'image/png';
                    extension = '.png';
            }
            
            imageCanvas.toBlob((blob) => {
                const filename = (currentImageFile ? currentImageFile.name.replace(/\.[^/.]+$/, '') : 'processed_image') + extension;
                downloadBlob(blob, filename);
            }, mimeType, quality);
        }

        // URL Shortener Functions
        function generateShortCode(length = 6) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function createShortUrl() {
            const originalUrl = document.getElementById('originalUrl').value.trim();
            const customCode = document.getElementById('customCode').value.trim();
            
            if (!originalUrl) {
                showToast('Please enter a URL to shorten', 'error');
                return;
            }
            
            // Validate URL format
            try {
                new URL(originalUrl);
            } catch {
                showToast('Please enter a valid URL (e.g., https://example.com)', 'error');
                return;
            }
            
            // Validate custom code
            if (customCode && !/^[a-zA-Z0-9-_]+$/.test(customCode)) {
                showToast('Custom code can only contain letters, numbers, hyphens and underscores', 'error');
                return;
            }
            
            // Check if custom code already exists
            if (customCode && urlDatabase.some(entry => entry.shortCode === customCode)) {
                showToast('This custom code is already taken. Please choose another one.', 'error');
                return;
            }
            
            const shortCode = customCode || generateShortCode();
            const shortUrl = `https://utilihub.app/${shortCode}`;
            
            // Create URL entry
            const urlEntry = {
                id: Date.now(),
                originalUrl: originalUrl,
                shortCode: shortCode,
                shortUrl: shortUrl,
                created: new Date().toISOString(),
                clicks: 0
            };
            
            urlDatabase.unshift(urlEntry);
            
            // Display results
            document.getElementById('shortUrl').textContent = shortUrl;
            document.getElementById('urlDisplay').classList.add('show');
            
            // Update history
            loadUrlHistory();
            
            // Clear form
            document.getElementById('originalUrl').value = '';
            document.getElementById('customCode').value = '';
            
            showToast('Short URL created successfully!', 'success');
        }

        function copyShortUrl() {
            const shortUrl = document.getElementById('shortUrl').textContent;
            navigator.clipboard.writeText(shortUrl).then(() => {
                showToast('Short URL copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = shortUrl;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('Short URL copied to clipboard!', 'success');
            });
        }

        function viewOriginalUrl() {
            const shortUrl = document.getElementById('shortUrl').textContent;
            const urlEntry = urlDatabase.find(entry => entry.shortUrl === shortUrl);
            
            if (urlEntry) {
                window.open(urlEntry.originalUrl, '_blank');
                showToast('Redirecting to original URL...', 'success');
            }
        }

        function loadUrlHistory() {
            const historyList = document.getElementById('urlHistoryList');
            
            if (urlDatabase.length === 0) {
                historyList.innerHTML = '<p style="color: #666; font-style: italic; text-align: center;">No URLs created yet</p>';
                return;
            }
            
            historyList.innerHTML = urlDatabase.slice(0, 10).map(entry => `
                <div style="background: white; border-radius: 8px; padding: 15px; margin: 10px 0; border: 1px solid #e9ecef;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <div style="font-weight: bold; color: #667eea; margin-bottom: 5px;">${entry.shortUrl}</div>
                            <div style="color: #666; font-size: 0.9em; margin-bottom: 5px;">${entry.originalUrl}</div>
                            <div style="color: #888; font-size: 0.8em; margin-top: 5px;">
                                Created: ${new Date(entry.created).toLocaleDateString()} • 
                                Clicks: ${entry.clicks}
                            </div>
                        </div>
                        <div style="margin-left: 15px;">
                            <button class="btn btn-secondary" onclick="copyUrlFromHistory('${entry.shortUrl}')" 
                                    style="padding: 5px 10px; font-size: 0.8em; margin-right: 5px;">Copy</button>
                            <button class="btn btn-warning" onclick="viewUrlFromHistory('${entry.originalUrl}')" 
                                    style="padding: 5px 10px; font-size: 0.8em;">Visit</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function copyUrlFromHistory(shortUrl) {
            navigator.clipboard.writeText(shortUrl).then(() => {
                showToast('URL copied to clipboard!', 'success');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = shortUrl;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('URL copied to clipboard!', 'success');
            });
        }

        function viewUrlFromHistory(originalUrl) {
            window.open(originalUrl, '_blank');
        }

        // QR Code Generator Functions
        function updateQrInputs() {
            const qrType = document.getElementById('qrType').value;
            const inputsContainer = document.getElementById('qrInputs');
            
            let inputHtml = '';
            
            switch (qrType) {
                case 'url':
                    inputHtml = `
                        <div class="form-group">
                            <label class="form-label">URL</label>
                            <input type="url" class="form-control" id="qrUrl" placeholder="https://example.com" onchange="generateQrCode()">
                        </div>
                    `;
                    break;
                case 'text':
                    inputHtml = `
                        <div class="form-group">
                            <label class="form-label">Text</label>
                            <textarea class="form-control" id="qrText" placeholder="Enter your text" onchange="generateQrCode()"></textarea>
                        </div>
                    `;
                    break;
                case 'email':
                    inputHtml = `
                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="qrEmail" placeholder="example@email.com" onchange="generateQrCode()">
                        </div>
                    `;
                    break;
                case 'phone':
                    inputHtml = `
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="qrPhone" placeholder="+1234567890" onchange="generateQrCode()">
                        </div>
                    `;
                    break;
                case 'wifi':
                    inputHtml = `
                        <div class="form-group">
                            <label class="form-label">Network Name (SSID)</label>
                            <input type="text" class="form-control" id="qrWifiSSID" placeholder="MyWiFi" onchange="generateQrCode()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="qrWifiPassword" placeholder="password" onchange="generateQrCode()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Security Type</label>
                            <select class="form-control" id="qrWifiSecurity" onchange="generateQrCode()">
                                <option value="WPA">WPA/WPA2</option>
                                <option value="WEP">WEP</option>
                                <option value="">None</option>
                            </select>
                        </div>
                    `;
                    break;
            }
            
            inputsContainer.innerHTML = inputHtml;
        }

        function generateQrCode() {
            const qrType = document.getElementById('qrType').value;
            const size = parseInt(document.getElementById('qrSize').value);
            const foreground = document.getElementById('qrForeground').value;
            const background = document.getElementById('qrBackground').value;
            
            let qrData = '';
            
            switch (qrType) {
                case 'url':
                    qrData = document.getElementById('qrUrl')?.value || '';
                    break;
                case 'text':
                    qrData = document.getElementById('qrText')?.value || '';
                    break;
                case 'email':
                    const email = document.getElementById('qrEmail')?.value || '';
                    qrData = email ? `mailto:${email}` : '';
                    break;
                case 'phone':
                    const phone = document.getElementById('qrPhone')?.value || '';
                    qrData = phone ? `tel:${phone}` : '';
                    break;
                case 'wifi':
                    const ssid = document.getElementById('qrWifiSSID')?.value || '';
                    const password = document.getElementById('qrWifiPassword')?.value || '';
                    const security = document.getElementById('qrWifiSecurity')?.value || '';
                    if (ssid) {
                        qrData = `WIFI:T:${security};S:${ssid};P:${password};;`;
                    }
                    break;
            }
            
            if (!qrData) {
                document.getElementById('qrCanvas').style.display = 'none';
                document.getElementById('qrPlaceholder').style.display = 'block';
                document.getElementById('downloadQrBtn').style.display = 'none';
                return;
            }
            
            const canvas = document.getElementById('qrCanvas');
            
            QRCode.toCanvas(canvas, qrData, {
                width: size,
                color: {
                    dark: foreground,
                    light: background
                }
            }, (error) => {
                if (error) {
                    console.error('QR Code generation error:', error);
                    showToast('Error generating QR code', 'error');
                } else {
                    document.getElementById('qrCanvas').style.display = 'block';
                    document.getElementById('qrPlaceholder').style.display = 'none';
                    document.getElementById('downloadQrBtn').style.display = 'block';
                }
            });
        }

        function downloadQrCode() {
            const canvas = document.getElementById('qrCanvas');
            if (!canvas) {
                showToast('No QR code to download', 'error');
                return;
            }
            
            canvas.toBlob((blob) => {
                downloadBlob(blob, 'qr-code.png');
            });
        }

        // Calculator Functions
        function calcNumber(num) {
            if (calcState.waitingForOperand) {
                calcState.display = num;
                calcState.waitingForOperand = false;
            } else {
                calcState.display = calcState.display === '0' ? num : calcState.display + num;
            }
            updateCalcDisplay();
        }

        function calcOperation(nextOperation) {
            const inputValue = parseFloat(calcState.display);

            if (calcState.previousValue === null) {
                calcState.previousValue = inputValue;
            } else if (calcState.operation) {
                const currentValue = calcState.previousValue || 0;
                const newValue = calculate(currentValue, inputValue, calcState.operation);

                calcState.display = String(newValue);
                calcState.previousValue = newValue;
            }

            calcState.waitingForOperand = true;
            calcState.operation = nextOperation;
            updateCalcDisplay();
        }

        function calcEquals() {
            const inputValue = parseFloat(calcState.display);

            if (calcState.previousValue !== null && calcState.operation) {
                const newValue = calculate(calcState.previousValue, inputValue, calcState.operation);
                
                // Add to history
                calcState.history.push(`${calcState.previousValue} ${calcState.operation} ${inputValue} = ${newValue}`);
                updateCalcHistory();
                
                calcState.display = String(newValue);
                calcState.previousValue = null;
                calcState.operation = null;
                calcState.waitingForOperand = true;
            }
            updateCalcDisplay();
        }

        function calcFunction(func) {
            const inputValue = parseFloat(calcState.display);
            let result;

            switch (func) {
                case 'sqrt':
                    result = Math.sqrt(inputValue);
                    break;
                case 'pow':
                    result = Math.pow(inputValue, 2);
                    break;
                default:
                    return;
            }

            calcState.display = String(result);
            calcState.waitingForOperand = true;
            updateCalcDisplay();
        }

        function calculate(firstValue, secondValue, operation) {
            switch (operation) {
                case '+':
                    return firstValue + secondValue;
                case '-':
                    return firstValue - secondValue;
                case '*':
                    return firstValue * secondValue;
                case '/':
                    return firstValue / secondValue;
                case '%':
                    return firstValue % secondValue;
                default:
                    return secondValue;
            }
        }

        function clearCalc() {
            calcState.display = '0';
            calcState.previousValue = null;
            calcState.operation = null;
            calcState.waitingForOperand = false;
            updateCalcDisplay();
        }

        function updateCalcDisplay() {
            document.getElementById('calcDisplay').value = calcState.display;
        }

        function updateCalcHistory() {
            const historyList = document.getElementById('calcHistoryList');
            if (calcState.history.length === 0) {
                historyList.innerHTML = '<p style="color: #666; font-style: italic;">No calculations yet</p>';
            } else {
                historyList.innerHTML = calcState.history.slice(-10).reverse().map(entry => 
                    `<div style="padding: 5px; border-bottom: 1px solid #eee;">${entry}</div>`
                ).join('');
            }
        }

        function clearHistory() {
            calcState.history = [];
            updateCalcHistory();
            showToast('Calculator history cleared', 'success');
        }

        // Text Tools Functions
        function updateTextStats() {
            const text = document.getElementById('textInput').value;
            
            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
            const charCount = text.length;
            const charCountNoSpaces = text.replace(/\s/g, '').length;
            const paragraphCount = text.trim() ? text.split(/\n\s*\n/).length : 0;
            const sentenceCount = text.trim() ? text.split(/[.!?]+/).filter(s => s.trim().length > 0).length : 0;
            const readingTime = Math.ceil(wordCount / 200); // Assuming 200 words per minute
            
            document.getElementById('wordCount').textContent = wordCount;
            document.getElementById('charCount').textContent = charCount;
            document.getElementById('charCountNoSpaces').textContent = charCountNoSpaces;
            document.getElementById('paragraphCount').textContent = paragraphCount;
            document.getElementById('sentenceCount').textContent = sentenceCount;
            document.getElementById('readingTime').textContent = readingTime;
        }

        function textTransform(type) {
            const textArea = document.getElementById('textInput');
            const text = textArea.value;
            
            if (!text) {
                showToast('Please enter some text first', 'error');
                return;
            }
            
            let transformedText;
            
            switch (type) {
                case 'uppercase':
                    transformedText = text.toUpperCase();
                    break;
                case 'lowercase':
                    transformedText = text.toLowerCase();
                    break;
                case 'capitalize':
                    transformedText = text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();
                    break;
                case 'title':
                    transformedText = text.replace(/\w\S*/g, (txt) => 
                        txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()
                    );
                    break;
                default:
                    return;
            }
            
            textArea.value = transformedText;
            updateTextStats();
            showToast('Text transformed successfully!', 'success');
        }

        function clearText() {
            document.getElementById('textInput').value = '';
            updateTextStats();
            showToast('Text cleared', 'success');
        }

        function copyText() {
            const text = document.getElementById('textInput').value;
            if (!text) {
                showToast('No text to copy', 'error');
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                showToast('Text copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                document.getElementById('textInput').select();
                document.execCommand('copy');
                showToast('Text copied to clipboard!', 'success');
            });
        }

        function loadTextFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('textInput').value = e.target.result;
                updateTextStats();
                showToast('File loaded successfully!', 'success');
            };
            reader.readAsText(file);
        }

        // Utility Functions
        function showProcessing(title, status = 'Please wait while we process your files') {
            document.getElementById('processingTitle').textContent = title;
            document.getElementById('processingStatus').textContent = status;
            document.getElementById('processingOverlay').classList.add('active');
        }

        function hideProcessing() {
            document.getElementById('processingOverlay').classList.remove('active');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            downloadBlob(blob, filename);
        }

        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
